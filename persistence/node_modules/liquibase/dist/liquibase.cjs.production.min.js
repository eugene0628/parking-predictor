"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("child_process"),n=require("path"),t=require("fs");function r(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,n,t){return n&&r(e.prototype,n),t&&r(e,t),e}function a(){return(a=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}var s,i,u=function(){function n(e){this.logger=new b(e)}return n.prototype.spawnChildProcess=function(n){var t=this;return this.logger.log("Running "+n+"..."),new Promise((function(r,o){e.exec(n,(function(e,n,a){if(t.logger.log("\n "+n),e)return t.logger.error("\n "+a),o(e);r(n)}))}))},n}(),l=function(){function e(){}return e.readFileContent=function(e){return t.readFileSync(e,{encoding:"utf-8"})},o(e,null,[{key:"bundledLiquibasePath",get:function(){return this.bundledLiquibasePathForExternalConsumers}},{key:"bundledLiquibasePathForExternalConsumers",get:function(){return n.join(__dirname,"liquibase/liquibase")}},{key:"bundledLiquibasePathForInternalConsumers",get:function(){return n.join(__dirname,"../../bin/liquibase/liquibase")}}]),e}();(s=exports.LiquibaseCommands||(exports.LiquibaseCommands={})).CalculateCheckSum="calculateCheckSum",s.ChangelogSync="changelogSync",s.ChangelogSyncSql="changelogSyncSQL",s.ChangelogSyncToTag="changelogSyncToTag",s.ChangelogSyncToTagSql="changelogSyncToTagSQL",s.ClearCheckSums="clearCheckSums",s.DbDoc="dbDoc",s.DeactivateChangeLog="deactivateChangeLog",s.Diff="diff",s.DiffChangeLog="diffChangeLog",s.DropAll="dropAll",s.FutureRollbackSql="futureRollbackSQL",s.FutureRollbackCountSql="futureRollbackCountSQL",s.GenerateChangeLog="generateChangeLog",s.Help="help",s.History="history",s.ListLocks="listLocks",s.MarkNextChangeSetRan="markNextChangeSetRan",s.MarkNextChangeSetRanSql="markNextChangeSetRanSQL",s.RegisterChangeLog="registerChangeLog",s.ReleaseLocks="releaseLocks",s.Rollback="rollback",s.RollbackCount="rollbackCount",s.RollbackCountSql="rollbackCountSQL",s.RollbackSql="rollbackSQL",s.RollbackToDate="rollbackToDate",s.RollbackToDateSql="rollbackToDateSQL",s.Snapshot="snapshot",s.SnapshotReference="snapshotReference",s.Status="status",s.SyncHub="syncHub",s.Tag="tag",s.TagExists="tagExists",s.UnexpectedChangeSets="unexpectedChangeSets",s.Update="update",s.UpdateSql="updateSQL",s.UpdateCount="updateCount",s.UpdateCountSql="updateCountSQL",s.UpdateTestingRollback="updateTestingRollback",s.UpdateToTag="updateToTag",s.UpdateToTagSql="updateToTagSQL",s.Validate="validate",(i=exports.LiquibaseLogLevels||(exports.LiquibaseLogLevels={})).Off="off",i.Severe="severe",i.Warning="warning",i.Info="info",i.Debug="debug";var c,g={url:"jdbc:sqlserver://<IP_OR_HOSTNAME>:;database=sqlserver;",changeLogFile:"/examples/change-log-examples/mssql/changelog.xml",username:"sa",password:"",classpath:n.join(__dirname,"../../../drivers/mssql-jdbc-7.4.1.jre8.jar")},h={changeLogFile:"/node_modules/examples/change-log-examples/postgreSQL/changelog.xml",url:"jdbc:postgresql://localhost:5432/postgres",username:"postgres",password:"",classpath:n.join(__dirname,"drivers/postgresql-42.2.8.jar")},b=function(){function e(e){this.config=e}var n=e.prototype;return n.log=function(e){return this._log(e)},n.warn=function(e){return this._warn(e)},n.error=function(e){return this._error(e)},n._log=function(e){var n=[exports.LiquibaseLogLevels.Debug,exports.LiquibaseLogLevels.Info,exports.LiquibaseLogLevels.Severe,exports.LiquibaseLogLevels.Warning];if(this.shouldOperate(n))return console.log("[NODE-LIQUIBASE] "+e)},n._warn=function(e){var n=[exports.LiquibaseLogLevels.Severe,exports.LiquibaseLogLevels.Warning];if(this.shouldOperate(n))return console.warn("[33m%s[0m","[NODE-LIQUIBASE] "+e)},n._error=function(e){var n=[exports.LiquibaseLogLevels.Severe];if(this.shouldOperate(n))return console.error("[31m%s[0m","[NODE-LIQUIBASE] "+e)},n.shouldOperate=function(e){return e.indexOf(this.logLevel)>-1},o(e,[{key:"logLevel",get:function(){var e;return(null==(e=this.config)?void 0:e.logLevel)||exports.LiquibaseLogLevels.Severe}}]),e}();!function(e){e.futureRollbackCount="futureRollbackCount",e.futureRollbackFromTag="futureRollbackFromTag",e.futureRollbackSQl="futureRollbackSQl",e.rollback="rollback",e.rollbackCount="rollbackCount",e.rollbackCountSQL="rollbackCountSQL",e.rollbackDate="rollbackDate",e.rollbackSql="rollbackSql",e.rollbackToDate="rollbackToDate",e.rollbackToDateSQL="rollbackToDateSQL",e.tag="tag"}(c||(c={}));var p=function(){function e(e){this.config=e,this.mergeConfigWithDefaults(e),this.commandHandler=new u(this.config)}var n=e.prototype;return n.update=function(e){return this.run(exports.LiquibaseCommands.Update,e)},n.updateSQL=function(e){return this.run(exports.LiquibaseCommands.UpdateSql,e)},n.updateCount=function(e){return this.run(exports.LiquibaseCommands.UpdateCount,e)},n.updateCountSQL=function(e){return this.run(exports.LiquibaseCommands.UpdateCountSql,e)},n.updateTestingRollback=function(){return this.run(exports.LiquibaseCommands.UpdateTestingRollback)},n.updateToTag=function(e){return this.run(exports.LiquibaseCommands.UpdateToTag,e)},n.updateToTagSQL=function(e){return this.run(exports.LiquibaseCommands.UpdateToTagSql,e)},n.validate=function(){return this.run(exports.LiquibaseCommands.Validate)},n.calculateCheckSum=function(e){return this.run(exports.LiquibaseCommands.CalculateCheckSum,e)},n.rollback=function(e){return this.run(exports.LiquibaseCommands.Rollback,e)},n.rollbackSQL=function(e){return this.run(exports.LiquibaseCommands.RollbackSql,e)},n.rollbackCount=function(e){return this.run(exports.LiquibaseCommands.RollbackCount,e)},n.rollbackCountSQL=function(e){return this.run(exports.LiquibaseCommands.RollbackCountSql,e)},n.rollbackToDate=function(e){return this.run(exports.LiquibaseCommands.RollbackToDate,e)},n.rollbackToDateSQL=function(e){return this.run(exports.LiquibaseCommands.RollbackToDateSql,e)},n.snapshot=function(e){return this.run(exports.LiquibaseCommands.Snapshot,e)},n.snapshotReference=function(e){return this.run(exports.LiquibaseCommands.SnapshotReference,e)},n.status=function(){return this.run(exports.LiquibaseCommands.Status)},n.syncHub=function(e){return this.run(exports.LiquibaseCommands.SyncHub,e)},n.tag=function(e){return this.run(exports.LiquibaseCommands.Tag,e)},n.tagExists=function(e){return this.run(exports.LiquibaseCommands.TagExists,e)},n.unexpectedChangeSets=function(){return this.run(exports.LiquibaseCommands.UnexpectedChangeSets)},n.dropAll=function(){return this.run(exports.LiquibaseCommands.DropAll)},n.futureRollbackSQL=function(){return this.run(exports.LiquibaseCommands.FutureRollbackSql)},n.futureRollbackCountSQL=function(e){return this.run(exports.LiquibaseCommands.FutureRollbackCountSql,e)},n.generateChangeLog=function(e){return this.run(exports.LiquibaseCommands.GenerateChangeLog,e)},n.help=function(){return this.run(exports.LiquibaseCommands.Help)},n.history=function(){return this.run(exports.LiquibaseCommands.History)},n.listLocks=function(){return this.run(exports.LiquibaseCommands.ListLocks)},n.markNextChangeSetRan=function(){return this.run(exports.LiquibaseCommands.MarkNextChangeSetRan)},n.markNextChangeSetRanSQL=function(){return this.run(exports.LiquibaseCommands.MarkNextChangeSetRanSql)},n.registerChangeLog=function(){return this.run(exports.LiquibaseCommands.RegisterChangeLog)},n.releaseLocks=function(){return this.run(exports.LiquibaseCommands.ReleaseLocks)},n.changelogSync=function(){return this.run(exports.LiquibaseCommands.ChangelogSync)},n.changelogSyncSQL=function(){return this.run(exports.LiquibaseCommands.ChangelogSyncSql)},n.changelogSyncToTag=function(e){return this.run(exports.LiquibaseCommands.ChangelogSyncToTag,e)},n.changelogSyncToTagSQL=function(e){return this.run(exports.LiquibaseCommands.ChangelogSyncToTagSql,e)},n.clearCheckSums=function(){return this.run(exports.LiquibaseCommands.ClearCheckSums)},n.dbDoc=function(e){return this.run(exports.LiquibaseCommands.DbDoc,e)},n.deactivateChangeLog=function(){return this.run(exports.LiquibaseCommands.DeactivateChangeLog)},n.diff=function(e){return this.run(exports.LiquibaseCommands.Diff,e)},n.diffChangelog=function(e){return this.run(exports.LiquibaseCommands.DiffChangeLog,e)},n.stringifyParams=function(e,n){var t=Object.values(c).includes(e),r="",o="";for(var a in n){var s=n[a];t?o+=JSON.stringify(s)+" ":r+="--"+a+"="+JSON.stringify(s)+" "}return o+" "+r},n.loadParamsFromLiquibasePropertiesFileOnDemand=function(e){var n={};if(e)return l.readFileContent(e).split(/\r?\n/).forEach((function(e){var t=e.split(/=?:/,2),r=t[0],o=t[1];n.hasOwnProperty(r)&&(n[r.trim()]=o.trim())})),n},n.run=function(e,n){void 0===n&&(n={});var t=a({},this.loadParamsFromLiquibasePropertiesFileOnDemand(this.config.liquibasePropertiesFile),this.config),r=this.stringifyParams(e,n);return this.spawnChildProcess(this.liquibasePathAndGlobalAttributes(t)+" "+e+" "+r)},n.liquibasePathAndGlobalAttributes=function(e){var n=this,t=""+e.liquibase;return Object.keys(e).forEach((function(e){"liquibase"!==e&&"liquibasePropertiesFile"!==e&&(t=t+" --"+e+'="'+n.config[e]+'"')})),t},n.spawnChildProcess=function(e){return this.commandHandler.spawnChildProcess(e)},n.mergeConfigWithDefaults=function(e){var n=a({},h,{liquibase:l.bundledLiquibasePath});this.config=Object.assign({},n,e)},e}();exports.CommandHandler=u,exports.FileHelper=l,exports.LIQUIBASE_LABEL="[NODE-LIQUIBASE]",exports.Liquibase=p,exports.Logger=b,exports.MSSQL_DEFAULT_CONFIG=g,exports.POSTGRESQL_DEFAULT_CONFIG=h;
//# sourceMappingURL=liquibase.cjs.production.min.js.map
